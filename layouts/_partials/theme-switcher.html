<div class="theme-switcher">
    <button class="theme-btn" id="theme-switcher-btn" aria-label="Change theme">
        <span class="theme-icon">theme</span>
        <code class="theme-key">t</code>
    </button>
    <div class="theme-terminal" id="theme-terminal">
        <div class="terminal-header">
            <span class="terminal-title">> theme --select</span>
            <button class="terminal-close" id="terminal-close">×</button>
        </div>
        <div class="terminal-body">
            <div class="terminal-prompt">
                <span class="prompt-text">Available themes:</span>
            </div>
            <div class="terminal-options">
                <button class="terminal-option" data-theme="nord">
                    <span class="option-bracket">[</span><span class="option-num">1</span><span class="option-bracket">]</span>
                    <span class="option-name">nord</span>
                    <span class="option-desc">// arctic blue (default)</span>
                </button>
                <button class="terminal-option" data-theme="dark">
                    <span class="option-bracket">[</span><span class="option-num">2</span><span class="option-bracket">]</span>
                    <span class="option-name">dark</span>
                    <span class="option-desc">// clean dark</span>
                </button>
                <button class="terminal-option" data-theme="light">
                    <span class="option-bracket">[</span><span class="option-num">3</span><span class="option-bracket">]</span>
                    <span class="option-name">light</span>
                    <span class="option-desc">// clean bright</span>
                </button>
                <button class="terminal-option" data-theme="gruvbox">
                    <span class="option-bracket">[</span><span class="option-num">4</span><span class="option-bracket">]</span>
                    <span class="option-name">gruvbox</span>
                    <span class="option-desc">// warm retro</span>
                </button>
                <button class="terminal-option" data-theme="catppuccin">
                    <span class="option-bracket">[</span><span class="option-num">5</span><span class="option-bracket">]</span>
                    <span class="option-name">catppuccin</span>
                    <span class="option-desc">// soft pastel</span>
                </button>
            </div>
            <div class="terminal-footer">
                <span class="terminal-hints">[j/k] navigate [↑/↓] navigate [enter] select [esc] close</span>
            </div>
        </div>
    </div>
</div>

<style>
.theme-switcher {
    position: relative;
    display: inline-block;
}

.theme-btn {
    background: transparent;
    border: 2px solid var(--border-color);
    color: var(--text-primary);
    font-family: 'Fira Mono', monospace;
    font-size: 0.9rem;
    padding: 4px 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 3px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.theme-btn:hover {
    border-color: var(--accent-secondary);
    color: var(--accent-secondary);
}

.theme-btn:hover .theme-key {
    border-color: var(--accent-secondary);
    color: var(--accent-secondary);
}

.theme-icon {
    opacity: 0.7;
}

.theme-key {
    border: 1px solid var(--border-color);
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.85rem;
    font-weight: bold;
    background: var(--bg-secondary);
    transition: all 0.2s ease;
}

.theme-terminal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 500px;
    background: var(--bg-darker);
    border: 2px solid var(--border-color);
    box-shadow: 0 0 0 4000px rgba(0, 0, 0, 0.7);
    z-index: 9999;
    font-family: 'Fira Mono', monospace;
    animation: terminalSlideIn 0.2s ease-out;
}

@keyframes terminalSlideIn {
    from {
        opacity: 0;
        transform: translate(-50%, -48%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

.theme-terminal.active {
    display: block;
}

.terminal-header {
    background: var(--bg-secondary);
    padding: 10px 15px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.terminal-title {
    color: var(--accent-secondary);
    font-size: 0.9rem;
}

.terminal-close {
    background: none;
    border: none;
    color: var(--accent-error);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.terminal-close:hover {
    color: var(--text-primary);
}

.terminal-body {
    padding: 20px;
}

.terminal-prompt {
    margin-bottom: 15px;
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.prompt-text::before {
    content: '> ';
    color: var(--prompt-user);
}

.terminal-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 15px;
}

.terminal-option {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    cursor: pointer;
    padding: 10px 15px;
    font-family: 'Fira Mono', monospace;
    font-size: 0.85rem;
    text-align: left;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.terminal-option:hover,
.terminal-option.highlighted {
    background: var(--bg-secondary);
    border-color: var(--accent-primary);
    transform: translateX(4px);
}

.terminal-option.active {
    border-color: var(--accent-secondary);
    background: var(--bg-secondary);
}

/* Nord theme option - preview nord colors */
.terminal-option[data-theme="nord"] {
    background: #2e3440;
    border-color: #4c566a;
    color: #eceff4;
}

.terminal-option[data-theme="nord"] .option-bracket { color: #81a1c1; }
.terminal-option[data-theme="nord"] .option-num { color: #ebcb8b; }
.terminal-option[data-theme="nord"] .option-name { color: #eceff4; }
.terminal-option[data-theme="nord"] .option-desc { color: #81a1c1; }

.terminal-option[data-theme="nord"]:hover,
.terminal-option[data-theme="nord"].highlighted {
    background: #3b4252;
    border-color: #88c0d0;
}

.terminal-option[data-theme="nord"].active {
    background: #3b4252;
    border-color: #a3be8c;
}

.terminal-option[data-theme="nord"].active .option-name {
    color: #a3be8c;
    font-weight: bold;
}

/* Dark theme option - preview dark colors */
.terminal-option[data-theme="dark"] {
    background: #292a2d;
    border-color: #404040;
    color: #f8f8ff;
}

.terminal-option[data-theme="dark"] .option-bracket { color: #a0a0a0; }
.terminal-option[data-theme="dark"] .option-num { color: #FFB300; }
.terminal-option[data-theme="dark"] .option-name { color: #f8f8ff; }
.terminal-option[data-theme="dark"] .option-desc { color: #a0a0a0; }

.terminal-option[data-theme="dark"]:hover,
.terminal-option[data-theme="dark"].highlighted {
    background: #252627;
    border-color: #80AADD;
}

.terminal-option[data-theme="dark"].active {
    background: #252627;
    border-color: #FF9800;
}

.terminal-option[data-theme="dark"].active .option-name {
    color: #FF9800;
    font-weight: bold;
}

/* Light theme option - preview light colors */
.terminal-option[data-theme="light"] {
    background: #f8f8ff;
    border-color: #d0d0d0;
    color: #2d2d2d;
}

.terminal-option[data-theme="light"] .option-bracket { color: #6d6d6d; }
.terminal-option[data-theme="light"] .option-num { color: #CC8C00; }
.terminal-option[data-theme="light"] .option-name { color: #2d2d2d; }
.terminal-option[data-theme="light"] .option-desc { color: #6d6d6d; }

.terminal-option[data-theme="light"]:hover,
.terminal-option[data-theme="light"].highlighted {
    background: #ffffff;
    border-color: #4080CC;
}

.terminal-option[data-theme="light"].active {
    background: #ffffff;
    border-color: #28A05A;
}

.terminal-option[data-theme="light"].active .option-name {
    color: #28A05A;
    font-weight: bold;
}

/* Gruvbox theme option - preview gruvbox colors */
.terminal-option[data-theme="gruvbox"] {
    background: #282828;
    border-color: #504945;
    color: #ebdbb2;
}

.terminal-option[data-theme="gruvbox"] .option-bracket { color: #a89984; }
.terminal-option[data-theme="gruvbox"] .option-num { color: #fabd2f; }
.terminal-option[data-theme="gruvbox"] .option-name { color: #ebdbb2; }
.terminal-option[data-theme="gruvbox"] .option-desc { color: #a89984; }

.terminal-option[data-theme="gruvbox"]:hover,
.terminal-option[data-theme="gruvbox"].highlighted {
    background: #1d2021;
    border-color: #83a598;
}

.terminal-option[data-theme="gruvbox"].active {
    background: #1d2021;
    border-color: #b8bb26;
}

.terminal-option[data-theme="gruvbox"].active .option-name {
    color: #b8bb26;
    font-weight: bold;
}

/* Catppuccin theme option - preview catppuccin colors */
.terminal-option[data-theme="catppuccin"] {
    background: #1e1e2e;
    border-color: #313244;
    color: #cdd6f4;
}

.terminal-option[data-theme="catppuccin"] .option-bracket { color: #6c7086; }
.terminal-option[data-theme="catppuccin"] .option-num { color: #f9e2af; }
.terminal-option[data-theme="catppuccin"] .option-name { color: #cdd6f4; }
.terminal-option[data-theme="catppuccin"] .option-desc { color: #6c7086; }

.terminal-option[data-theme="catppuccin"]:hover,
.terminal-option[data-theme="catppuccin"].highlighted {
    background: #181825;
    border-color: #89b4fa;
}

.terminal-option[data-theme="catppuccin"].active {
    background: #181825;
    border-color: #a6e3a1;
}

.terminal-option[data-theme="catppuccin"].active .option-name {
    color: #a6e3a1;
    font-weight: bold;
}

.option-bracket {
    color: var(--text-dim);
}

.option-num {
    color: var(--accent-warning);
    font-weight: bold;
}

.option-name {
    color: var(--text-primary);
    min-width: 110px;
}

.terminal-option.active .option-name {
    color: var(--accent-secondary);
    font-weight: bold;
}

.option-desc {
    color: var(--text-dim);
    font-size: 0.75rem;
    font-style: italic;
}

.terminal-footer {
    color: var(--text-primary);
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding-top: 10px;
    border-top: 1px solid var(--border-color);
    opacity: 0.7;
}

.terminal-hints {
    font-style: italic;
}

@media screen and (max-width: 600px) {
    .theme-terminal {
        width: 95%;
        max-width: none;
    }
    
    .terminal-body {
        padding: 15px;
    }
    
    .option-desc {
        display: none;
    }
}
</style>

<script>
(function() {
    // Get saved theme or default to 'nord'
    const savedTheme = localStorage.getItem('color-theme') || 'nord';
    
    // Apply theme on load
    function applyTheme(theme) {
        if (theme === 'nord') {
            document.documentElement.removeAttribute('data-theme');
        } else {
            document.documentElement.setAttribute('data-theme', theme);
        }
        localStorage.setItem('color-theme', theme);
        
        // Update active state in terminal
        document.querySelectorAll('.terminal-option').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.theme === theme);
        });
        
        // Update button text to show current theme
        const themeIcon = document.querySelector('.theme-icon');
        if (themeIcon) {
            themeIcon.textContent = theme;
        }
    }
    
    // Apply saved theme immediately to prevent flash
    applyTheme(savedTheme);
    
    // Setup theme switcher when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('theme-switcher-btn');
        const terminal = document.getElementById('theme-terminal');
        const closeBtn = document.getElementById('terminal-close');
        
        if (!btn || !terminal) return;
        
        // Open terminal
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            terminal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Initialize highlight on first option
            const options = document.querySelectorAll('.terminal-option');
            options.forEach(opt => opt.classList.remove('highlighted'));
            if (options.length > 0) {
                options[0].classList.add('highlighted');
            }
        });
        
        // Close terminal
        function closeTerminal() {
            terminal.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        closeBtn.addEventListener('click', closeTerminal);
        
        // Close on backdrop click
        terminal.addEventListener('click', function(e) {
            if (e.target === terminal) {
                closeTerminal();
            }
        });
        
        // Handle keyboard shortcuts globally
        document.addEventListener('keydown', function(e) {
            // Don't interfere if user is typing in input/textarea
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            const isTerminalOpen = terminal.classList.contains('active');
            
            // Open terminal with 't' key (only when closed)
            if (e.key === 't' && !isTerminalOpen) {
                e.preventDefault();
                terminal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Initialize highlight on first option
                const options = document.querySelectorAll('.terminal-option');
                options.forEach(opt => opt.classList.remove('highlighted'));
                if (options.length > 0) {
                    options[0].classList.add('highlighted');
                }
                return;
            }
            
            // Close on escape key (only when terminal is open)
            if (e.key === 'Escape' && isTerminalOpen) {
                closeTerminal();
                return;
            }
            
            // Handle j/k and arrow navigation when terminal is open
            if (isTerminalOpen) {
                const options = Array.from(document.querySelectorAll('.terminal-option'));
                const currentIndex = options.findIndex(opt => opt.classList.contains('highlighted'));
                let newIndex = currentIndex;
                
                if (e.key === 'j' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    newIndex = currentIndex < options.length - 1 ? currentIndex + 1 : 0;
                } else if (e.key === 'k' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    newIndex = currentIndex > 0 ? currentIndex - 1 : options.length - 1;
                } else if (e.key === 'Enter' && currentIndex >= 0) {
                    e.preventDefault();
                    const theme = options[currentIndex].dataset.theme;
                    applyTheme(theme);
                    closeTerminal();
                    return;
                }
                
                // Update highlighted state
                if (newIndex !== currentIndex) {
                    options.forEach(opt => opt.classList.remove('highlighted'));
                    options[newIndex].classList.add('highlighted');
                    options[newIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                }
            }
            
            // Handle theme selection with number keys (1-5)
            const themes = ['nord', 'dark', 'light', 'gruvbox', 'catppuccin'];
            const key = e.key;
            
            // Check for both regular digits and numpad digits
            let num = null;
            if (key >= '1' && key <= '5') {
                num = parseInt(key);
            }
            
            if (num !== null && num >= 1 && num <= 5) {
                e.preventDefault(); // Prevent any default behavior
                const themeName = themes[num - 1];
                applyTheme(themeName);
                // Only close terminal if it's open, otherwise show notification
                if (isTerminalOpen) {
                    closeTerminal();
                } else {
                    // Show notification for global theme change
                    if (window.showNotification) {
                        window.showNotification(`theme changed to ${themeName}`);
                    }
                }
            }
        });
        
        // Handle theme selection with clicks
        document.querySelectorAll('.terminal-option').forEach(option => {
            option.addEventListener('click', function(e) {
                e.stopPropagation();
                const theme = this.dataset.theme;
                applyTheme(theme);
                closeTerminal();
            });
        });
    });
})();
</script>
