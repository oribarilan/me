{{/*
  View Counter Partial - Display only (no increment)
  
  Usage:
    {{ partial "view-counter.html" (dict "postId" .Params.postId) }}
  
  Parameters:
    - postId: The unique post identifier for the API call
    - elementId: Optional unique ID suffix for multiple counters on same page
  
  Note: This partial only fetches and displays view counts.
  Incrementing is handled by the analytics.html partial in baseof.html.
*/}}

{{ $postId := .postId | default "" }}
{{ $elementIdSuffix := .elementId | default "" }}
{{ $elementId := printf "view-count%s" $elementIdSuffix }}

<span class="viewCounter">
  <span id="{{ $elementId }}" class="viewCount">--</span> views
</span>

{{ if $postId }}
<script>
(function() {
  const postId = "{{ $postId | safeJS }}";
  const elementId = "{{ $elementId | safeJS }}";
  const isLocal = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1";
  
  if (isLocal) {
    const el = document.getElementById(elementId);
    if (el) el.textContent = "42";
    return;
  }
  
  const url = "https://www.oribi.sh/api/views?slug=" + encodeURIComponent(postId) + "&mode=get";

  fetch(url)
    .then(r => r.json())
    .then(data => {
      const el = document.getElementById(elementId);
      if (el && typeof data.views === "number") {
        el.textContent = data.views.toLocaleString();
      }
    })
    .catch(() => {
      // Silently fail - keep showing "--"
    });
})();
</script>
{{ end }}
