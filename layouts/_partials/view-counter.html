{{/*
  View Counter Partial
  
  Usage:
    {{ partial "view-counter.html" (dict "postId" .Params.postId "increment" true) }}
  
  Parameters:
    - postId: The unique post identifier for the API call
    - increment: If true, increments view count (default). If false, just fetches.
    - elementId: Optional unique ID suffix for multiple counters on same page
*/}}

{{ $postId := .postId | default "" }}
{{ $increment := .increment | default true }}
{{ $elementIdSuffix := .elementId | default "" }}
{{ $elementId := printf "view-count%s" $elementIdSuffix }}

<span class="viewCounter">
  <span id="{{ $elementId }}" class="viewCount">--</span> views
</span>

{{ if $postId }}
<script>
(function() {
  const postId = {{ $postId }};
  const increment = {{ $increment }};
  const elementId = {{ $elementId }};
  const mode = increment ? "" : "&mode=get";
  const isLocal = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1";
  
  if (isLocal) {
    const el = document.getElementById(elementId);
    if (el) el.textContent = "42";
    return;
  }
  
  const url = "/api/views?slug=" + encodeURIComponent(postId) + mode;

  fetch(url)
    .then(r => r.json())
    .then(data => {
      const el = document.getElementById(elementId);
      if (el && typeof data.views === "number") {
        el.textContent = data.views.toLocaleString();
      }
    })
    .catch(() => {
      // Silently fail - keep showing "--"
    });
})();
</script>
{{ end }}
